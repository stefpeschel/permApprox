% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/make_gpd_ctrl.R
\name{make_gpd_ctrl}
\alias{make_gpd_ctrl}
\title{Create a control list for GPD approximation}
\usage{
make_gpd_ctrl(
  fit_method = "LME",
  include_obs = FALSE,
  constraint = "support_at_obs",
  eps_rule = "slls",
  eps_par = 0.25,
  zero_guard = TRUE,
  eps_retry = list(step_init = 10, grow = (1 + sqrt(5))/2, max_expand_iter = 20L,
    bisect_iter_max = 30L, bisect_tol = 0.1),
  sample_size = NULL,
  tol = 1e-08,
  thresh_method = "rob_ftr",
  thresh0 = NULL,
  thresh_step = 10,
  exceed0 = 0.25,
  exceed0_min = 250,
  exceed_min = 10,
  gof_test = "ad",
  gof_alpha = 0.05
)
}
\arguments{
\item{fit_method}{Character. Method for GPD fitting. Options: "LME", "MLE1D",
"MLE2D", "MOM", "NLS2", "WNLLSM", "ZSE". Default: "LME".}

\item{include_obs}{Logical scalar. If \code{TRUE}, the observed test statistic is
included into the tail approximation (considered as permutation test statistic).
Default: \code{FALSE}.}

\item{constraint}{Character. Constraint for the fitting process. Default:
\code{"support_at_obs"}. Options:
\describe{
  \item{\code{"unconstrained"}}{No constraint (epsilon is not used).}
  \item{\code{"shape_nonneg"}}{Shape parameter must be non-negative.}
  \item{\code{"support_at_obs"}}{Positive density at the observed test statistic.}
  \item{\code{"support_at_max"}}{Positive density at the maximum observed
    test statistic (multiple testing case).}
}}

\item{eps_rule}{Character. Rule for computing \eqn{\varepsilon}. Used only if
\code{constraint != "unconstrained"}. One of:
\itemize{
  \item \code{"constant"}: fixed \eqn{\varepsilon}, set by \code{eps_par}.
  \item \code{"factor"}: \eqn{\varepsilon = c\,|t_{\mathrm{obs}}|} with \code{c = eps_par}.
  \item \code{"slls"}: Standardized Lifted Log-Saturation (Z-scale with
        permutation-based cap); \code{eps_par} acts as \emph{target_factor}.
}}

\item{eps_par}{Numeric. Parameter for \code{eps_rule}. If \code{eps_rule = "constant"},
this may be a scalar (same \eqn{\varepsilon} for all tests) or a vector (per-test).
For \code{"factor"} and \code{"slls"} this must be a non-negative scalar.}

\item{zero_guard}{Logical. If \code{TRUE}, enable adaptive epsilon refinement to
eliminate machine-underflow p-values during GPD fitting (guarding at
\code{.Machine$double.xmin}). Only used if \code{constraint != "unconstrained"}.}

\item{eps_retry}{List of tuning parameters for the adaptive epsilon refinement.
Only used when \code{zero_guard = TRUE} and \code{constraint != "unconstrained"}.
Recognized fields (defaults in parentheses):
\describe{
  \item{\code{step_init}}{Initial additive step for the target factor (10).}
  \item{\code{grow}}{Geometric growth factor for the step (>1; default
                     \eqn{(1+\sqrt{5})/2 \approx 1.618}).}
  \item{\code{max_expand_iter}}{Max expansion iterations (20).}
  \item{\code{bisect_iter_max}}{Max bisection iterations (30).}
  \item{\code{bisect_tol}}{Bisection tolerance (0.1).}
}}

\item{sample_size}{Optional numeric. Required for \code{eps_rule = "slls"} when
\code{constraint != "unconstrained"}. For groups with different sizes, use the
smaller one.}

\item{tol}{Numeric > 0. Convergence tolerance for fitting GPD parameters.
Default: 1e-8.}

\item{thresh_method}{Character. Method for threshold detection. Default:
\code{"rob_ftr"}. Options: \code{"fix"}, \code{"ftr"}, \code{"rob_ftr"},
\code{"rpc"}, \code{"fwd_stop"}, \code{"gof_cp"}.}

\item{thresh0}{Numeric or NULL. Initial threshold (fixed when
\code{thresh_method = "fix"}). Must be NULL if \code{exceed0} is provided.}

\item{thresh_step}{Integer >= 1. Step size for adaptive threshold search.}

\item{exceed0}{Numeric or NULL. Initial number (or proportion < 1) of 
exceedances. Must be NULL if \code{thresh0} is provided. Default: 0.25.}

\item{exceed0_min}{Integer. Minimum initial number of exceedances. The actual 
exceed0 value is the maximum of \code{exceed0} and \code{exceed0_min}.
If \code{NULL}, no minimum is enforced.
Default: 250 (threshold search starts with at least 250 exceedances).}

\item{exceed_min}{Integer >= 0. Minimum exceedances required for fitting.
Default: 10.}

\item{gof_test}{Character. Goodness-of-fit test for GPD: \code{"ad"}, \code{"cvm"},
or \code{"none"}. Default: \code{"ad"}.}

\item{gof_alpha}{Numeric in (0,1). Significance level for GOF test. Default: 0.05.}
}
\value{
A named list of class \code{"gpd_ctrl"} containing GPD settings.
}
\description{
Constructs a list of control parameters for the Generalized Pareto
Distribution (GPD) tail approximation method used in permApprox.
}
\section{Constraints and epsilon}{

Epsilon-related settings (\code{eps_rule}, \code{eps_par}, \code{sample_size},
and \code{eps_retry}/\code{zero_guard}) are only relevant when
\code{constraint != "unconstrained"}. If \code{constraint == "unconstrained"},
epsilon is not used and these arguments are ignored (\code{eps_rule} is set to
\code{"constant"} with \code{eps_par = 0}, and \code{zero_guard} is disabled).
}

