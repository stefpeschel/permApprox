---
output: github_document
---

## permApprox 1.0.1.9000 <img src="man/figures/logo.png" align="right" height="180" />

### ‚ú® New features

* Add option to disable discreteness screening in GPD and Gamma approximation. 
* `perm_approx()` now exports the tuning parameter used for the epsilon rule. 

### üöÄÔ∏è Improvements

* Update `print()` and `summary()` methods for `perm_approx` results. 
* Make `limma` an optional dependency to make package installation easier.

### üêõ Bug-fixes

* Fix parallel execution in GPD approximation and add proper testing

## permApprox 1.0.1

### ‚ú® New features

* `perm_approx()` now exports the object **`n_perm_exceed`**, 
  giving per-test counts   of permutations that are at least as extreme as the 
  observed statistic. 
  This corresponds to the numerator $r$ in the empirical permutation p-value 
  formula $p = (r + 1) / (B + 1)$.
* Added a new argument **`gof_test_thresh`** to `make_gpd_ctrl()` to control 
  which GOF test is used during threshold search (Anderson‚ÄìDarling or
  Cram√©r‚Äìvon-Mises). The existing argument **`gof_test`** is now used to define 
  the GoF test used for the final GPD fit (for the final threshold, 
  with constraint, after epsilon refinement, etc.).
* Added internal GPD Anderson-Darling and Cram√©r-von Mises critical value
  tables derived from the `eva` package, removing the need to access
  `eva:::ADQuantiles` and `eva:::CVMQuantiles` at run time. These tables are
  now shipped as internal data and used by the GPD GOF machinery.
  
### üöÄÔ∏è Improvements

* Improved parallel execution in **`.compute_pvals_gpd()`**: 
  Workers are now started only once and reused across all parallel phases 
  (threshold detection, GPD fitting, zero-guard refits). 
  This avoids repeated worker startup and large data transfers, resulting in 
  substantially faster runtime, especially on Windows.
* Removed the unused `doPlot` argument from internal functions, simplifying
  the GPD threshold/diagnostic code path.
* Applied several minor internal refactorings and clean-ups to the GPD
  approximation code and related helpers.

### üêõ Bug-fixes

* `.find_gpd_thresh()` threw an error ("Threshold method not supported.") 
  for the `rob_ftr` threshold selection method if some of the GoF tests were 
  accepted, but never three in a row. In these cases, the loop does not stop 
  early, which caused an error.
* Empirical / approximated p-values were not computed
  correctly for the one-sided alternatives `"greater"` and `"less"`.
* Fixed a bug in the `shape_nonneg` constraint for GPD fitting that could lead
  to incorrect or failed fits when enforcing non-negative shape parameters.

### üìö Documentation & tests

* Added more comprehensive unit tests for `perm_approx()` and the GPD
  approximation stack, increasing coverage of different alternatives,
  constraints, and control settings.

## permApprox 1.0.0

### ‚ö†Ô∏è Compatibility

Version 1.0.0 introduces changes that are **not fully compatible** with version 
0.1.0.  
Most importantly, the permutation statistic matrix 
**must now have tests in columns and permutations in rows** (the opposite 
orientation from earlier versions).  

Several other interface and workflow changes may also require minor updates in 
existing analysis scripts. Please review the NEWS entries below for details.


### ‚ú® New features

* Renamed the main function from `compute_p_values()` to **`perm_approx()`** to 
  be more concise and package-branded.
* Added a new argument **`approx_thresh`** (formerly `fit_thresh`) to specify 
  the empirical p-value threshold under which parametric approximation is applied.
* Introduced **`print.perm_approx()`** and **`summary.perm_approx()`** S3 
  methods for cleaner interactive output and diagnostic summaries.
* Unified approximation output under a single slot **`fit_result`**; 
  removed dual `gpd_fit` / `gamma_fit` slots for simplicity.
* Added a **`method_used`** output vector to track whether each test used 
  empirical, Gamma, or GPD p-value.
* Extended the Gamma-approximation branch of the code: now includes a `status` 
  factor (success, discrete, fit_failed, gof_reject) and parallel fitting support.
* Enhanced the GPD branch: improved threshold-detection methods, new 
  `eps_factor()` handling, improved support-constraint handling 
  (`support_at_obs`, `support_at_max`, `unconstrained`), and fixed edge-cases 
  (shape = 0, zero exceedances).
* Added `cores` and `parallel_min` arguments in the main function for parallel 
  execution of threshold detection and fitting (via the `future` framework).
* Cleaned up and simplified the workflow: one-sided transformation moved to 
  global helper, argument defaults updated, improved error-handling and 
  documentation.

### üêõ Bug-fixes

* Fixed internal `\_pgpd_upper_tail()` behavior for shape = 0.
* Fixed the `.compute_pvals_gamma()` logic to correctly calculate scaled tail 
  probabilities when `include_obs = TRUE`.
* Changed default parameter values in control objects to more sensible settings; 
  fixed mismatches between documentation and code.
* Several improvements to `threshold_detection` logic: cleaned up method names, 
  improved stability of exceedance counts, and fixed progress-bar behaviour on 
  Windows.

### üìö Documentation & tests

* Updated the README, manual pages, and examples to reflect the new features.
* Added comprehensive `testthat` tests covering empirical mode, GPD 
  approximation, Gamma approximation, print/summary methods, and 
  multiple-testing adjustment behaviour.
* Streamlined package imports and removed unused dependencies.

